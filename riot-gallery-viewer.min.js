const RiotGalleryViewer={galleries:[],galleryBlank:{elem:null,elemId:null,initImgs:[],items:[],isHtmlBuilt:!1,isLoaded:!1,isError:!1,errorMessages:[],imageFileUrl:null,isImageFileUrlComplete:!1},galleryItemBlank:{url:null,clickElem:null,caption:null,isError:!1,isLoaded:!1,width:null,height:null},viewers:[],viewerCurKey:null,viewerPrevKey:null,viewerBlank:{galKey:null,itemKey:null,height:null,width:null,left:null,top:null,closeRight:null,closeTop:null,padding:null,transition:{}},isViewerHtmlLoaded:!1,isViewerOpen:!1,blankImageSrc:'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=',elems:{body:null,bg:null,caption:null,captionCon:null,closeCons:[],images:[],imageCons:[],nextCon:null,prevCon:null},transition:null,transitionBlank:{jsInterval:null,startTimeMs:null,endTimeMs:null},swipeInfo:{startX:null,startTime:null},options:{doConsoleLog:!1,doConsoleTrace:!1,preloadImagesType:'prevnext',useMaterialIcons:!0,transitionType:'slide',transitionSeconds:0.7,transitionFrameSeconds:0.04,imageFailedCaptionHtml:'<i>Could Not Load Image</i>',defaultImgSize:300,doTouchSwipe:!0,swipeMinPixels:200,swipeMinPercent:50,swipeMaxSeconds:0.8},validPreloadImagesTypes:['none','prevnext','galleryload','pageload'],validTransitionTypes:['none','slide','fade','slidefade','size'],materialIconsCssUrl:'https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined',isMaterialIconsLoadComplete:!1,windowWidth:null,windowHeight:null,addImage(galleryElemId,url,thumbUrl,caption){const galKey=this.getGalKeyByElemId(galleryElemId);if(galKey===!1){this.consoleError('addImage failed, could not find gallery',galleryElemId);return!1}
if(this.addInitImage(galKey,url,thumbUrl,caption)){this.consoleLog('image added',url)}else{this.consoleError('image added failed',url)}},addImagesByFile(galleryElemId,fileUrl){if(!fileUrl||typeof fileUrl!=='string'){this.consoleError('addGalleryByString failed, no fileUrl',fileUrl,typeof fileUrl);return!1}
const galKey=this.getGalKeyByElemId(galleryElemId);if(galKey===!1){this.consoleError('could not add add images to failed gallery',galleryElemId);return!1}
this.galleries[galKey].imageFileUrl=fileUrl;this.consoleLog('Image list file set for adding to gallery',galleryElemId,fileUrl)},setOption(option,value){if(!option){this.consoleError('setOption called with no option');return!1}
if(typeof option!=='string'){this.consoleError('setOption requires the option (field) to be a string',option);return!1}
if(typeof value==='undefined'){this.consoleError('setOption called with no value',option);return!1}
const passedOption=option;option=option.toLowerCase();switch(option){case 'preloadImagesType'.toLowerCase():return this.setOptionFromValid('preloadImagesType',value,this.validPreloadImagesTypes);case 'doConsoleLog'.toLowerCase():return this.setOptionBoolean('doConsoleLog',value);case 'doConsoleTrace'.toLowerCase():return this.setOptionBoolean('doConsoleTrace',value);case 'useMaterialIcons'.toLowerCase():return this.setOptionBoolean('useMaterialIcons',value);case 'transitionSeconds'.toLowerCase():return this.setOptionFloat('transitionSeconds',value,0.1,5);case 'transitionFrameSeconds'.toLowerCase():return this.setOptionFloat('transitionFrameSeconds',value,0.02,0.25);case 'imageFailedCaptionHtml'.toLowerCase():return this.setOptionString('imageFailedCaptionHtml',value);case 'defaultImgSize'.toLowerCase():return this.setOptionFloat('defaultImgSize',value,200,1000);case 'transitionType'.toLowerCase():return this.setOptionFromValid('transitionType',value,this.validTransitionTypes);case 'doTouchSwipe'.toLowerCase():return this.setOptionBoolean('doTouchSwipe',value);case 'swipeMinPixels'.toLowerCase():return this.setOptionFloat('swipeMinPixels',value,0,1000);case 'swipeMinPercent'.toLowerCase():return this.setOptionFloat('swipeMinPercent',value,0,90);case 'swipeMaxSeconds'.toLowerCase():return this.setOptionFloat('swipeMaxSeconds',value,0,2)}
this.consoleError('invalid option',passedOption,value);return!1},setOptionBoolean(option,value){if(typeof value==='string'){const lc=value.toLowerCase();if(lc==='off'||lc==='no'||lc==='false'){this.options[option]=!1;this.consoleLog('boolean option value set by string',option,this.options[option]);return!0}}
if(value){this.options[option]=!0}else{this.options[option]=!1}
this.consoleLog('boolean option value set',option,this.options[option]);return!0},setOptionFloat(option,value,min,max){const valueType=typeof value;if(valueType==='number'){}else if(valueType==='string'){if(isNaN(value)){this.consoleError('option value must be a number, string passed',option,value);return!1}
value=parseFloat(value)}else if(valueType==='null'){value=0}else{this.consoleError('option value must be a number',option,value,typeof value);return!1}
if(value<min||value>max){this.consoleError('option value not in range',option,value,'must be between',min,'and',max);return!1}
if(value>max){this.consoleError('invalid option value, must be less than maximum',option,value,max);return!1}
this.options[option]=value;this.consoleLog('number option value set',option,value);return!0},setOptionString(option,value){const valueType=typeof value;if(valueType==='string'){}else if(valueType==='null'){value=''}else if(valueType==='number'||valueType==='bigint'){value=value.toString()}else{this.consoleError('option value must be a string',option,value,typeof value);return!1}
this.options[option]=value;this.consoleLog('string option value set',option,value);return!0},setOptionFromValid(option,value,validValues){if(validValues.indexOf(value)>=0){this.options[option]=value;this.consoleLog('valid option value set',option,value);return!0}
this.consoleError('option is not value',option,validValues,value);return!1},initialize(){this.consoleLog('Riot Gallery Viewer - begin initialization of loaded data');const hasGalleryWithFileRemoteUrl=this.processGalleryFileRemoteUrls();if(!hasGalleryWithFileRemoteUrl){this.initializeRemoteComplete()}},initializeRemoteComplete(){this.galleries.forEach((gal)=>{if(gal.imageFileUrl&&!gal.isImageFileUrlComplete&&!gal.isError){return}});this.buildHtmlGalleries();this.setGalleriesByClass();if(this.options.preloadImagesType==='pageload'){this.preloadAllImages()}},preloadAllImages(){this.galleries.forEach((gal,galKey)=>{this.preloadGalleryImages(galKey)})},preloadGalleryImages(galKey){if(!this.galleries[galKey]){return}
this.galleries[galKey].items.forEach((item,itemKey)=>{this.preloadImage(galKey,itemKey)})},preloadImage(galKey,itemKey){if(!this.galleries[galKey]){return}
if(itemKey<0){itemKey=this.galleries[galKey].items.length-1}
if(itemKey>=this.galleries[galKey].items.length){itemKey=0}
if(!this.galleries[galKey].items[itemKey]){return}
const item=this.galleries[galKey].items[itemKey];if(item.isLoaded||item.isError){return}
const img=new Image();img.src=item.url;img.galKey=galKey;img.itemKey=itemKey;this.consoleLog('start image preload',item.url);img.onload=function(e){RiotGalleryViewer.consoleLog('image preload successful',img.src);RiotGalleryViewer.updateGalItem(this.galKey,this.itemKey,img,!1)};img.onerror=function(e){RiotGalleryViewer.consoleError('image preload error',this.src);RiotGalleryViewer.updateGalItem(this.galKey,this.itemKey,null,!0)}},processGalleryFileRemoteUrls(){let hasGalleryWithFileRemoteUrl=!1;this.galleries.forEach((gal,galKey)=>{if(gal.imageFileUrl){this.processGalleryFileRemoteUrl(galKey);hasGalleryWithFileRemoteUrl=!0}});return hasGalleryWithFileRemoteUrl},processGalleryFileRemoteUrl(galKey){if(!this.galleries[galKey]){return!1}
if(!this.galleries[galKey].imageFileUrl){return!1}
const url=this.galleries[galKey].imageFileUrl;const xhr=this.createXHR();if(!xhr){this.galleries[galKey].isError=!0;const msg='could not create an XHR request. could not read remote file.';this.galleries[galKey].errorMessages.push(msg+url);this.consoleError(msg,url);return}
xhr.open('GET',url,!0);xhr.galKey=galKey;xhr.onreadystatechange=function(){const galKey=xhr.galKey;if(xhr.readyState===4){if(xhr.status===200){RiotGalleryViewer.addGalleryImagesByText(galKey,xhr.responseText)}else{RiotGalleryViewer.galleries[galKey].isError=!0;RiotGalleryViewer.galleries[galKey].errorMessages.push('could not read file: '+xhr.responseURL)}
RiotGalleryViewer.galleries[galKey].isImageFileUrlComplete=!0;RiotGalleryViewer.initializeRemoteComplete()}};xhr.send()},addGalleryImagesByText(galKey,text){let parsed=null;text=this.strReplaceAll(["\r\n","\n\r","\r"],"\n",text);text=text.trim();if(!text){this.galleries[galKey].isError=!0;this.galleries[galKey].errorMessages.push('addGalleryImagesByText - text file is empty: '+galKey);return!1}
const firstChar=text.substring(0,1);const lastChar=text.substring(text.length-1);if(firstChar==='['&&lastChar===']'){parsed=this.parseJson(text)}
if(parsed){parsed.forEach((parsedItem)=>{this.addImageByObj(galKey,parsedItem)})}else{const lines=text.split("\n");lines.forEach((line)=>{this.addImageByString(galKey,line)})}},addImageByObj(galKey,obj){if(!this.galleries[galKey]){return!1}
if(typeof obj!=='object'){return!1}
let url=null;let thumbUrl=null;let caption=null;if(Array.isArray(obj)){if(obj[0]){url=obj[0].trim()}
if(obj[1]){thumbUrl=obj[1].trim()}
if(obj[2]){caption=obj[2].trim()}}else{if(obj.url){url=obj.url.trim()}
if(obj.thumbUrl){thumbUrl=obj.thumbUrl.trim()}
if(obj.caption){caption=obj.caption.trim()}}
this.addInitImage(galKey,url,thumbUrl,caption);return!0},addImageByString(galKey,line){let url=null;let thumbUrl=null;let caption=null;const strs=line.split("\t");if(strs.length>1){if(strs[0]){url=this.strStripStartEndQuotes(strs[0])}
if(strs[1]){thumbUrl=this.strStripStartEndQuotes(strs[1])}
if(strs[2]){caption=this.strStripStartEndQuotes(strs[2])}
this.addInitImage(galKey,url,thumbUrl,caption)}else{this.addImageByStringsWithQuotes(galKey,line)}},strStripStartEndQuotes(str){const tempQuoteReplace="[~~(quote here, riot gallery)~~]";str=this.strReplaceAll('\\"',tempQuoteReplace,str).trim();if(str.length<1){return''}
const first=str.substring(0,1);if(first==='"'){str=str.substring(1);if(str.length<1){return''}}
const last=str.substring(str.length-1);if(last==='"'){str=str.substring(0,str.length-1);if(str.length<1){return''}}
str=this.strReplaceAll(tempQuoteReplace,'"',str).trim();return str},addImageByStringsWithQuotes(galKey,line){const tempQuoteReplace="[~~(quote here, riot gallery)~~]";line=this.strReplaceAll('\\"',tempQuoteReplace,line);line=line.trim();const strs=line.split('"');let url=null;let thumbUrl=null;let caption=null;if(strs[1]){url=this.strReplaceAll(tempQuoteReplace,'"',strs[1])}
if(strs[3]){thumbUrl=this.strReplaceAll(tempQuoteReplace,'"',strs[3])}
if(strs[5]){caption=this.strReplaceAll(tempQuoteReplace,'"',strs[5])}
this.addInitImage(galKey,url,thumbUrl,caption)},buildHtmlGalleries(){this.galleries.forEach((gal,galKey)=>{if(!gal.isHtmlBuilt&&!gal.isError){this.buildHtmlGallery(galKey)}})},buildHtmlGallery(galKey){if(!this.galleries[galKey]){return!1}
const gal=this.galleries[galKey];if(gal.isError){return!1}
if(gal.isHtmlBuilt){return!1}
if(gal.initImgs.length<1){return!1}
this.setGalleryElem(galKey);if(!this.galleries[galKey].elem){return!1}
this.addGalleryLiItemsFromInitImages(galKey)},setGalleryElem(galKey){if(!this.galleries[galKey]){return!1}
if(!this.galleries[galKey].elemId){this.galleries[galKey].isError=!0;this.galleries[galKey].errorMessages.push('setGalleryElem - gallery Elem ID not set');return!1}
let elem=document.getElementById(this.galleries[galKey].elemId);if(!elem){this.galleries[galKey].isError=!0;this.galleries[galKey].errorMessages.push('setGalleryElem - gallery Elem ID not found: '+this.galleries[galKey].elemId);return!1}
let tagName=this.getElemTagName(elem);if(!tagName){this.galleries[galKey].isError=!0;this.galleries.errorMessages.push('setGalleryElem - could not get element tag name: '+this.galleries[galKey].elemId);return!1}
tagName=tagName.trim().toLowerCase();let ulElem=null;if(tagName==='ul'||tagName==='ol'){ulElem=elem;ulElem.classList.add('riot-gallery-style')}else if(tagName==='div'){ulElem=document.createElement('ul');ulElem.classList='riot-gallery-style';elem.innerHTML='';elem.appendChild(ulElem)}else{ulElem=document.createElement('ul');ulElem.classList='riot-gallery-style';this.insertAfter(elem,ulElem)}
this.galleries[galKey].elem=ulElem;return!0},addGalleryLiItemsFromInitImages(galKey){if(!this.galleries[galKey]){return!1}
let isImageAdded=!1;this.galleries[galKey].initImgs.forEach((initImg,initImgKey)=>{if(this.addGalleryLiItemFromInitImage(galKey,initImgKey)){isImageAdded=!0}});if(!isImageAdded){this.galleries[galKey].isError=!0;this.galleries[galKey].errorMessages.push('addGalleryLiItemsFromInitImages - no images set');return!1}
this.galleries[galKey].isHtmlBuilt=!0;this.galleries[galKey].isLoaded=!0;return!0},addGalleryLiItemFromInitImage(galKey,initImageKey){if(!this.galleries[galKey]){return!1}
if(!this.galleries[galKey].initImgs[initImageKey]){return!1}
if(!this.galleries[galKey].elem){return!1}
const initImage=this.galleries[galKey].initImgs[initImageKey];if(typeof initImage.url!=='string'){return!1}
if(initImage.url.length<1){return!1}
let url=initImage.url;let thumbUrl=initImage.url;let caption=null;if(typeof initImage.thumbUrl==='string'){if(initImage.thumbUrl.length>0){thumbUrl=initImage.thumbUrl}}
if(typeof initImage.caption==='number'){caption=caption.toString()}else if(typeof initImage.caption==='string'){if(initImage.caption.length>0){caption=initImage.caption}}
let liElem=document.createElement('li');let aElem=document.createElement('a');aElem.href=url;aElem.setAttribute('target','_blank');if(!this.setGalleryItem(galKey,url,aElem,caption)){return!1}
let imgElem=document.createElement('img');imgElem.src=thumbUrl;aElem.appendChild(imgElem);liElem.appendChild(aElem);if(caption){let divCapElem=document.createElement('div');divCapElem.innerHTML=caption;divCapElem.className="riot-gallery-caption";liElem.appendChild(divCapElem)}
this.galleries[galKey].elem.appendChild(liElem);return!0},getGalKeyByElemId(elemId){if(typeof elemId!=='string'){this.consoleError('cannot add gallery, invalid elemId type',elemId,typeof elemId);return!1}
if(elemId.length<1){this.consoleError('cannot add gallery, elemId is empty',elemId,typeof elemId);return!1}
this.galleries.forEach((gal,galKey)=>{if(gal.elemId===elemId){if(gal.isError){return!1}
return galKey}});let gal=this.getByVal(this.galleryBlank);gal.elemId=elemId;this.consoleLog('new gallery added',elemId);this.galleries.push(gal);return this.galleries.length-1},addInitImage(galKey,url,thumbUrl,caption){if(!this.galleries[galKey]){return!1}
if(!url||typeof url!=='string'){return!1}
const initImg={url:url,thumbUrl:thumbUrl,caption:caption};this.galleries[galKey].initImgs.push(initImg);return!0},setGalleriesByClass(){const elems=document.getElementsByClassName('riot-gallery');if(!elems){return}
for(let x=0;x<elems.length;x++){this.setGalleryByElem(elems[x],null)}},setGalleryByElem(galElem,galKey){if(galKey===null){galKey=this.getNewGalKeyByElem(galElem);if(galKey===null){return!1}}
if(this.galleries[galKey].isError){return!1}
let elems=galElem.getElementsByClassName('riot-gallery-item');if(elems.length<1){const tagName=this.getElemTagName(galElem);if(tagName=='ul'||tagName=='ol'){elems=galElem.getElementsByTagName('li')}else if(tagName=='table'){elems=galElem.getElementsByTagName('td')}else{elems=galElem.getElementsByTagName('figure')}}
if(elems.length<1){this.galleries[galKey].isError=!0;this.galleries[galKey].errorMessages.push('no items (image containers) found');this.consoleError('gallery not loaded. no items (image containers) found',galKey);return!1}
for(let elemKey=0;elemKey<elems.length;elemKey++){this.setGalItemByElem(galKey,elems[elemKey])}
if(this.galleries[galKey].items.length<1){this.galleries[galKey].isError=!0;this.galleries[galKey].errorMessages.push('no items found');this.consoleError('gallery not loaded. no valid items (image containers) found',galKey);return!1}
this.galleries[galKey].isLoaded=!0;return!0},getNewGalKeyByElem(elem){if(!this.getElemTagName(elem)){return!1}
this.galleries.forEach((gal,galKey)=>{if(gal.elem===elem){if(gal.isError){return!1}
return galKey}});let gal=this.getByVal(this.galleryBlank);gal.elem=elem;this.galleries.push(gal);return this.galleries.length-1},setGalItemByElem(galKey,elem){const url=this.getImgUrlFromConElem(elem);if(!url){return!1}
const clickElem=this.getClickElemFromConElem(elem);if(clickElem){this.galleries.forEach((gal)=>{gal.items.forEach((item)=>{if(item.clickElem===clickElem){return!1}})})}
const caption=this.getCaptionFromConElem(elem);return this.setGalleryItem(galKey,url,clickElem,caption)},setGalleryItem(galKey,url,clickElem,caption){if(!this.galleries[galKey]){return!1}
if(!url){return!1}
if(clickElem){clickElem.galKey=galKey;clickElem.itemKey=this.galleries[galKey].items.length;clickElem.addEventListener('click',function(event){event.preventDefault();RiotGalleryViewer.itemClicked(this.galKey,this.itemKey)},!1)}
let item=this.getByVal(this.galleryItemBlank);item.url=url;item.clickElem=clickElem;if(caption){item.caption=caption}
this.galleries[galKey].items.push(item);return!0},getImgUrlFromConElem(conElem){let url;url=this.getSubElemAttrVal(conElem,'data-riot-gallery-image-url');if(url){return url}
url=this.getSubElemAttrValBySelector(conElem,'a.riot-gallery-image-link','href');if(url){return url}
url=this.getSubElemAttrValBySelector(conElem,'img.riot-gallery-image-thumb','src');if(url){return url}
url=this.getSubElemAttrValBySelector(conElem,'a','href');if(url){return url}
url=this.getSubElemAttrValBySelector(conElem,'img','src');if(url){return url}
return null},getClickElemFromConElem(conElem){let elem=this.getSubElemBySelector(conElem,'.riot-gallery-item-clickable');if(elem){return elem}
elem=this.getSubElemBySelector(conElem,'a.riot-gallery-image-link');if(elem){return elem}
elem=this.getSubElemBySelector(conElem,'img.riot-gallery-image-thumb');if(elem){return elem}
elem=this.getElemSubByAttr(conElem,'data-riot-gallery-image-url');if(elem){return elem}
elem=this.getSubElemBySelector(conElem,'a');if(elem){return elem}
elem=this.getSubElemBySelector(conElem,'img');if(elem){return elem}
return conElem},getCaptionFromConElem(conElem){let caption=this.getSubElemAttrVal(conElem,'data-riot-gallery-caption');if(caption){return caption}
caption=this.getSubElemTextBySelector(conElem,'.riot-gallery-caption','text');if(caption){return caption}
caption=this.getSubElemTextBySelector(conElem,'figcaption','text');if(caption){return caption}
let imgElems=conElem.getElementsByTagName('img');for(let x=0;x<imgElems.length;x++){const imgElem=imgElems[x];if(imgElem.classList.contains('riot-gallery-image-thumb')){let caption=imgElem.getAttribute('title');if(caption){return caption}
caption=imgElem.getAttribute('alt');if(caption){return caption}}}
for(let x=0;x<imgElems.length;x++){const imgElem=imgElems[x];let caption=imgElem.getAttribute('title');if(caption){return caption}
caption=imgElem.getAttribute('alt');if(caption){return caption}}
return null},itemClicked(galKey,itemKey){this.loadImage(galKey,itemKey,null)},prevClicked(){this.incrementImageAndLoad(-1,'prev')},nextClicked(){this.incrementImageAndLoad(1,'next')},incrementImageAndLoad(increment,transDirection){if(!increment){return}
let galKey=null;let itemKey=null;const viewItem=this.getViewerCur();if(viewItem){galKey=viewItem.galKey;itemKey=viewItem.itemKey}
if(galKey===null){galKey=0}
if(itemKey===null){itemKey=0}else{itemKey+=increment;const itemCount=this.galleries[galKey].items.length;if(itemKey>=itemCount){itemKey=0}else if(itemKey<0){itemKey=itemCount-1}}
this.loadImage(galKey,itemKey,transDirection)},closeClicked(){this.closeViewer()},windowResized(){if(!this.isViewerOpen){return}
this.setWindowSize();this.calculateViewerPlacement();this.placeImgInPosition()},loadViewerHtml(){if(this.isViewerHtmlLoaded){return}
this.elems.body=document.body;const checkElem=document.getElementById('riot-gallery-viewer-bg');if(!checkElem){let divElem=null;let aElem=null;let subDivElem=null;let imgElem=null;window.addEventListener('resize',function(){RiotGalleryViewer.windowResized()});if(this.options.doTouchSwipe){window.addEventListener("touchstart",function(event){if(!RiotGalleryViewer.isViewerOpen){return}
RiotGalleryViewer.slideSwipeStartEvent(event)});window.addEventListener("touchend",function(event){if(!RiotGalleryViewer.isViewerOpen){return}
RiotGalleryViewer.slideSwipeEndEvent(event)})}
divElem=document.createElement('div');divElem.id='riot-gallery-viewer-bg';divElem.addEventListener('click',function(event){event.preventDefault();event.stopPropagation();RiotGalleryViewer.closeClicked()},!1);this.elems.bg=divElem;this.elems.body.appendChild(divElem);divElem=document.createElement('div');divElem.id='riot-gallery-viewer-prev-con';aElem=document.createElement('a');aElem.innerHTML='&laquo;';aElem.href='#';divElem.appendChild(aElem);divElem.addEventListener('click',function(event){event.preventDefault();event.stopPropagation();RiotGalleryViewer.prevClicked()},!1);this.elems.prevCon=divElem;this.elems.body.appendChild(divElem);divElem=document.createElement('div');divElem.id='riot-gallery-viewer-next-con';aElem=document.createElement('a');aElem.innerHTML='&raquo;';aElem.href='#';divElem.appendChild(aElem);divElem.addEventListener('click',function(event){event.preventDefault();event.stopPropagation();RiotGalleryViewer.nextClicked()},!1);this.elems.nextCon=divElem;this.elems.body.appendChild(divElem);this.elems.closeCons=[];this.elems.images=[];this.elems.imageCons=[];for(let x=0;x<2;x++){divElem=document.createElement('div');divElem.id='riot-gallery-viewer-image-con'+x;divElem.classList='riot-gallery-viewer-image-con';subDivElem=document.createElement('div');subDivElem.id='riot-gallery-viewer-close-con'+x;subDivElem.classList='riot-gallery-viewer-close-con';aElem=document.createElement('a');aElem.innerHTML='X';aElem.href='#';aElem.addEventListener('click',function(event){event.preventDefault();event.stopPropagation();RiotGalleryViewer.closeClicked()},!1);subDivElem.appendChild(aElem);this.elems.closeCons[x]=subDivElem;divElem.appendChild(subDivElem);imgElem=document.createElement('img');imgElem.id='riot-gallery-viewer-image'+x;imgElem.classList='riot-gallery-viewer-image';imgElem.src=this.blankImageSrc;this.elems.images[x]=imgElem;divElem.appendChild(imgElem);subDivElem=document.createElement('div');subDivElem.id='riot-gallery-viewer-loading'+x;subDivElem.classList='riot-gallery-viewer-loading';divElem.appendChild(subDivElem);divElem.addEventListener('click',function(event){event.preventDefault();event.stopPropagation();RiotGalleryViewer.nextClicked()},!1);this.elems.imageCons[x]=divElem;this.elems.body.appendChild(divElem)}
divElem=document.createElement('div');divElem.id='riot-gallery-viewer-caption-con';subDivElem=document.createElement('div');subDivElem.id='riot-gallery-viewer-caption';this.elems.caption=subDivElem;divElem.appendChild(subDivElem);this.elems.captionCon=divElem;this.elems.body.appendChild(divElem);this.consoleLog('load viewer HTML complete')}
if(this.options.useMaterialIcons){this.loadMaterialIcons()}},areMaterialIconsLoaded(){let divElem=document.createElement('div');divElem.style.position="fixed";divElem.style.opacity=0;divElem.style.left=0;divElem.style.top=0;let spanElem=document.createElement('span');spanElem.classList='material-symbols-outlined';spanElem.innerHTML='arrow_back_ios_new';divElem.appendChild(spanElem);this.elems.body.appendChild(divElem);const w=divElem.offsetWidth;document.body.removeChild(divElem);if(w<50){this.consoleLog('Material Icons are already available.');return!0}
return!1},loadMaterialIcons(){if(this.isMaterialIconsLoadComplete){this.addMaterialIconsToHtml();return}
if(this.areMaterialIconsLoaded()){this.addMaterialIconsToHtml();return}
const styleLink=document.createElement('link');styleLink.rel='stylesheet';styleLink.type='text/css';styleLink.href=this.materialIconsCssUrl;styleLink.onload=function(){RiotGalleryViewer.consoleLog('Material Icons are loaded');RiotGalleryViewer.isMaterialIconsLoadComplete=!0;RiotGalleryViewer.addMaterialIconsToHtml()};styleLink.onerror=function(){RiotGalleryViewer.consoleError('Could not load Material Icons')};document.head.appendChild(styleLink)},addMaterialIconsToHtml(){let closeElems=document.getElementsByClassName('riot-gallery-viewer-close-con');for(let x=0;x<closeElems.length;x++){let closeAs=closeElems[x].getElementsByTagName('a');for(let x=0;x<closeAs.length;x++){let spanElem=document.createElement('span');spanElem.classList='material-symbols-outlined';spanElem.innerHTML='close';closeAs[x].innerHTML='';closeAs[x].appendChild(spanElem)}}
let prevElem=document.getElementById('riot-gallery-viewer-prev-con');if(prevElem){let prevAs=prevElem.getElementsByTagName('a');for(let x=0;x<prevAs.length;x++){let spanElem=document.createElement('span');spanElem.classList='material-symbols-outlined';spanElem.innerHTML='arrow_back_ios_new';prevAs[x].innerHTML='';prevAs[x].appendChild(spanElem)}}
let nextElem=document.getElementById('riot-gallery-viewer-next-con');if(nextElem){let nextAs=nextElem.getElementsByTagName('a');for(let x=0;x<nextAs.length;x++){let spanElem=document.createElement('span');spanElem.classList='material-symbols-outlined';spanElem.innerHTML='arrow_forward_ios';nextAs[x].innerHTML='';nextAs[x].appendChild(spanElem)}}},slideSwipeStartEvent(event){const temp=this.getSwipeXYFromEvent(event);if(temp===null){this.swipeInfoReset();this.consoleLog('slideSwipeStartEvent - no position found, stop swipe action;');return}
const x=temp[0];this.swipeInfo.startX=x;this.swipeInfo.startTime=this.getCurMs();this.consoleLog('slideSwipeStartEvent - position = '+x)},slideSwipeEndEvent(event){if(!this.swipeInfo.startX||!this.swipeInfo.startTime){this.swipeInfoReset();this.consoleLog('slideSwipeEndEvent - end swipe with no start swipe, stop swipe action');return}
if(this.options.swipeMaxSeconds){const timeDif=this.getCurMs()-this.swipeInfo.startTime;if(timeDif>this.options.swipeMaxSeconds*1000){this.swipeInfoReset();this.consoleLog('slideSwipeEndEvent - slide time too long, stop swipe action, max seconds = '+this.options.swipeMaxSeconds+', seconds taken = '+(timeDif/1000));return}}
const temp=this.getSwipeXYFromEvent(event);if(temp===null){this.swipeInfoReset();this.consoleLog('slideSwipeEndEvent - no position found, stop swipe action');return}
const x=temp[0];const xDif=Math.abs(x-this.swipeInfo.startX);if(this.options.swipeMinPixels||this.options.swipeMinPercent){let swipeDistanceSuccess=!1;if(this.options.swipeMinPixels){if(xDif>=this.options.swipeMinPixels){swipeDistanceSuccess=!0}}
if(!swipeDistanceSuccess&&this.options.swipeMinPercent){const widthPercent=xDif/window.innerWidth*100;if(widthPercent>=this.options.swipeMinPercent){swipeDistanceSuccess=!0}}
if(!swipeDistanceSuccess){this.swipeInfoReset();this.consoleLog('swipe distance was insufficient. Do not go to next image.');return}}
if(x<this.swipeInfo.startX){this.consoleLog('slideSwipeEndEvent - previous');this.incrementImageAndLoad(-1,'prev')}else{this.consoleLog('slideSwipeEndEvent - next');this.incrementImageAndLoad(1,'next')}},swipeInfoReset(){this.swipeInfo.startX=null;this.swipeInfo.startTime=null},getSwipeXYFromEvent(event){if(event.TouchList){if(event.TouchList[0]){if(event.TouchList[0].screenX&&event.TouchList[0].screenY){return[event.TouchList[0].pageX,event.TouchList[0].pageY]}}}
if(event.changedTouches){if(event.changedTouches[0]){if(event.changedTouches[0].screenX&&event.changedTouches[0].screenX){return[event.changedTouches[0].screenX,event.changedTouches[0].screenY]}}}
return null},loadImage(galKey,itemKey,transDirection){const galItem=this.getGalItem(galKey,itemKey);if(!galItem){return}
this.endTransition();let isOpenViewerNow=!1;if(!this.isViewerOpen){if(!this.isViewerHtmlLoaded){this.loadViewerHtml()}
this.openViewer();this.setWindowSize();isOpenViewerNow=!0}
if(this.viewerCurKey===null||this.options.transitionType==='none'){this.viewerCurKey=0}else{this.viewerPrevKey=this.viewerCurKey;this.viewerCurKey++;if(this.viewerCurKey>=2){this.viewerCurKey=0}}
this.viewers[this.viewerCurKey]=this.getByVal(this.viewerBlank);this.viewers[this.viewerCurKey].galKey=galKey;this.viewers[this.viewerCurKey].itemKey=itemKey;if(!galItem.isLoaded&&!galItem.isError){var img=new Image();img.src=galItem.url;if(img.complete){this.consoleLog('display already loaded image',img);this.updateGalItem(galKey,itemKey,img,!1)}else{img.galKey=galKey;img.itemKey=itemKey;img.onload=function(e){RiotGalleryViewer.consoleLog('image url successfully loaded',img.src);RiotGalleryViewer.updateGalItem(this.galKey,this.itemKey,img,!1);if(!RiotGalleryViewer.isViewerOpen||RiotGalleryViewer.galKey===null||RiotGalleryViewer.itemKey===null){return!1}
const viewer=RiotGalleryViewer.getViewerCur();if(viewer.galKey===this.galKey&&viewer.itemKey===this.itemKey){RiotGalleryViewer.calculateViewerPlacement();RiotGalleryViewer.placeImgInPosition()}};img.onerror=function(e){RiotGalleryViewer.consoleError('image url load error',this.src);RiotGalleryViewer.updateGalItem(this.galKey,this.itemKey,null,!0);const viewer=RiotGalleryViewer.getViewerCur();if(viewer.galKey===this.galKey&&viewer.itemKey===this.itemKey){RiotGalleryViewer.calculateViewerPlacement();RiotGalleryViewer.placeImgInPosition();RiotGalleryViewer.updateCaption()}};this.consoleLog('load image',img)}}
this.calculateViewerPlacement(transDirection);this.placeImgInPosition();this.updateCaption();if(this.options.preloadImagesType==='prevnext'){this.preloadImage(galKey,itemKey+1);this.preloadImage(galKey,itemKey-1)}else if(isOpenViewerNow&&this.options.preloadImagesType==='galleryload'){this.preloadGalleryImages(galKey)}},openViewer(){if(this.isViewerOpen){return}
this.elems.body.classList.add('riot-gallery-viewer-open');this.isViewerOpen=!0},closeViewer(){this.elems.body.classList.remove('riot-gallery-viewer-open');this.isViewerOpen=!1;this.resetViewerValues()},resetViewerValues(){for(let x=0;x<this.elems.imageCons.length;x++){this.elems.images[x].src=this.blankImageSrc;this.elems.imageCons[x].classList.remove('is-displayed')}
this.viewerCurKey=null;this.viewerPrevKey=null},updateGalItem(galKey,itemKey,img,isError){if(!this.isGalItem(galKey,itemKey)){return}
if(isError||!img){this.galleries[galKey].items[itemKey].isError=!0;return}
if(!img.width||!img.height){this.galleries[galKey].items[itemKey].isError=!0;RiotGalleryViewer.consoleError('invalid image. can not load',img.url);return}
this.galleries[galKey].items[itemKey].width=img.width;this.galleries[galKey].items[itemKey].height=img.height;this.galleries[galKey].items[itemKey].isError=!1;this.galleries[galKey].items[itemKey].isLoaded=!0},endTransition(){if(this.transition){clearInterval(this.transition.jsInterval);this.transition=null}
if(this.viewerCurKey!==null){let viewer=this.getViewerCur();if(viewer.transition){for(var prop in viewer.transition){if(Object.prototype.hasOwnProperty.call(viewer.transition,prop)){if(prop==='left'){this.elems.imageCons[this.viewerCurKey].style.left=viewer.left+'px'}else if(prop==='top'){this.elems.imageCons[this.viewerCurKey].style.top=viewer.top+'px'}else if(prop==='width'){this.elems.imageCons[this.viewerCurKey].style.width=viewer.width+'px'}else if(prop==='height'){this.elems.imageCons[this.viewerCurKey].style.height=viewer.height+'px'}else if(prop==='opacity'){this.elems.imageCons[this.viewerCurKey].style.opacity=1}}}}
this.viewers[this.viewerCurKey].transition=null}
this.removePrevViewer()},removePrevViewer(){if(this.viewerPrevKey!==null){this.elems.imageCons[this.viewerPrevKey].classList.remove('is-displayed');this.elems.images[this.viewerPrevKey].src=this.blankImageSrc;this.viewers[this.viewerPrevKey]=null;this.viewerPrevKey=null}},transitionFrame(){if(!this.transition){this.endTransition();return}
const curMs=this.getCurMs();const k=this.viewerCurKey;const viewer=this.viewers[k];if(!this.transition.endTimeMs||curMs>this.transition.endTimeMs){this.endTransition();return}
const timeSinceTransStart=curMs-this.transition.startTimeMs;const percentToEnd=timeSinceTransStart/(this.options.transitionSeconds*1000);const percentToStart=1-percentToEnd;let prevViewer=null;if(this.viewerPrevKey!==null){prevViewer=this.viewers[this.viewerPrevKey]}
for(var prop in viewer.transition){if(Object.prototype.hasOwnProperty.call(viewer.transition,prop)){if(prop==='left'){let newLeft;if(prevViewer){newLeft=(percentToStart*prevViewer.left)+(percentToEnd*prevViewer.transition[prop]);this.elems.imageCons[this.viewerPrevKey].style.left=newLeft+'px'}
newLeft=(percentToStart*viewer.transition[prop])+(percentToEnd*viewer.left);this.elems.imageCons[k].style.left=newLeft+'px'}else if(prop==='top'){let newTop;if(prevViewer){newTop=(percentToStart*prevViewer.top)+(percentToEnd*prevViewer.transition[prop]);this.elems.imageCons[this.viewerPrevKey].style.top=newTop+'px'}
newTop=(percentToStart*viewer.transition[prop])+(percentToEnd*viewer.top);this.elems.imageCons[k].style.top=newTop+'px'}else if(prop==='width'){let newWidth;if(prevViewer){newWidth=(percentToStart*prevViewer.width)+(percentToEnd*prevViewer.transition[prop]);this.elems.imageCons[this.viewerPrevKey].style.width=newWidth+'px'}
newWidth=(percentToStart*viewer.transition[prop])+(percentToEnd*viewer.width);this.elems.imageCons[k].style.width=newWidth+'px'}else if(prop==='height'){let newHeight;if(prevViewer){newHeight=(percentToStart*prevViewer.height)+(percentToEnd*prevViewer.transition[prop]);this.elems.imageCons[this.viewerPrevKey].style.height=newHeight+'px'}
newHeight=(percentToStart*viewer.transition[prop])+(percentToEnd*viewer.height);this.elems.imageCons[k].style.height=newHeight+'px'}else if(prop==='opacity'){let newOpacity;if(prevViewer){newOpacity=(percentToStart*1)+(percentToEnd*0);this.elems.imageCons[this.viewerPrevKey].style.opacity=newOpacity}
newOpacity=(percentToStart*0)+(percentToEnd*1);this.elems.imageCons[k].style.opacity=newOpacity}}}},setWindowSize(){this.windowWidth=window.innerWidth;this.windowHeight=window.innerHeight},calculateViewerPlacement(transDirection){if(!transDirection){transDirection=null}
const item=this.getCurGalItem();let imgWidth=this.options.defaultImgSize;let imgHeight=this.options.defaultImgSize;let isLoadingImage=!0;let conPadding=0;if(item.isLoaded&&!item.isError&&item.width&&item.height){imgWidth=item.width;imgHeight=item.height;isLoadingImage=!1}
let viewerWidth=imgWidth;let viewerHeight=imgHeight;const maxWidth=this.windowWidth-40;const maxHeight=this.windowHeight-24;if(viewerWidth>maxWidth){viewerWidth=maxWidth;viewerHeight=imgHeight/imgWidth*viewerWidth}
if(viewerHeight>maxHeight){viewerHeight=maxHeight;viewerWidth=imgWidth/imgHeight*viewerHeight}
let viewerLeft=(this.windowWidth-viewerWidth)/2;let viewerTop=(this.windowHeight-viewerHeight)/2;if(isLoadingImage){viewerLeft=viewerLeft-8;viewerTop=viewerTop-8;conPadding=8}
let closeRight=-28;let closeTop=-28;if(viewerTop<36){closeTop=closeTop+(36-viewerTop)}
if(viewerLeft<98){closeRight=closeRight+(98-viewerLeft)}
const curK=this.viewerCurKey;this.viewers[curK].width=viewerWidth;this.viewers[curK].height=viewerHeight;this.viewers[curK].left=viewerLeft;this.viewers[curK].top=viewerTop;this.viewers[curK].closeTop=closeTop;this.viewers[curK].closeRight=closeRight;this.viewers[curK].padding=conPadding;const transExtraDistance=4;const closeXWidth=40;if(transDirection!==null){const prevK=this.viewerPrevKey;this.viewers[curK].transition={};if(prevK!==null){this.viewers[prevK].transition={}}
if(prevK!==null){if(this.options.transitionType==='slide'||this.options.transitionType==='slidefade'){if(transDirection==='prev'){this.viewers[curK].transition.left=(this.windowWidth+transExtraDistance);this.viewers[prevK].transition.left=-(this.viewers[prevK].width+transExtraDistance+closeXWidth)}else if(transDirection==='next'){this.viewers[curK].transition.left=-(this.viewers[prevK].width+transExtraDistance+closeXWidth);this.viewers[prevK].transition.left=(this.windowWidth+transExtraDistance)}}
if(this.options.transitionType==='size'){this.viewers[curK].transition.width=this.viewers[prevK].width;this.viewers[curK].transition.height=this.viewers[prevK].height;this.viewers[curK].transition.left=this.viewers[prevK].left;this.viewers[curK].transition.top=this.viewers[prevK].top}}
if(this.options.transitionType==='fade'||this.options.transitionType==='slidefade'){this.viewers[curK].transition.opacity=0;if(prevK!==null){this.viewers[prevK].transition.opacity=0}}}},updateImgClassesAndSrc(){const item=this.getCurGalItem();const curK=this.viewerCurKey;let src=this.blankImageSrc;if(item.isError){this.elems.imageCons[curK].classList.add('is-error');this.elems.imageCons[curK].classList.remove('is-loading')}else if(!item.isLoaded){this.elems.imageCons[curK].classList.add('is-loading');this.elems.imageCons[curK].classList.remove('is-error')}else{this.elems.imageCons[curK].classList.remove('is-loading','is-error');if(item.url){src=item.url}}
this.elems.images[curK].src=src;this.elems.imageCons[curK].classList.add('is-displayed')},placeImgInPosition(){const curK=this.viewerCurKey;if(curK===null){return}
const viewer=this.getViewerCur();let curLeft=viewer.left;let curTop=viewer.top;let curWidth=viewer.width;let curHeight=viewer.height;if(this.transition){for(var prop in viewer.transition){if(Object.prototype.hasOwnProperty.call(viewer.transition,prop)){if(prop==='left'){curLeft=null}else if(prop==='top'){curTop=null}else if(prop==='width'){curWidth=null}else if(prop==='height'){curHeight=null}}}}
let isNewTransition=!1;if(curLeft!==null){if(viewer.transition){if(Object.keys(viewer.transition).length>0){isNewTransition=!0;this.transition=this.getByVal(this.transitionBlank);this.transition.startTimeMs=this.getCurMs();this.transition.endTimeMs=this.transition.startTimeMs+(this.options.transitionSeconds*1000);this.transition.jsInterval=setInterval(function(){RiotGalleryViewer.transitionFrame()},this.options.transitionFrameSeconds*1000);if(viewer.transition.hasOwnProperty('left')){if(viewer.transition.left!==null){curLeft=viewer.transition.left}}
if(viewer.transition.hasOwnProperty('top')){if(viewer.transition.top!==null){curTop=viewer.transition.top}}
if(viewer.transition.hasOwnProperty('width')){if(viewer.transition.width!==null){curWidth=viewer.transition.width}}
if(viewer.transition.hasOwnProperty('height')){if(viewer.transition.height!==null){curHeight=viewer.transition.height}}}}}
if(curLeft!==null){this.elems.imageCons[curK].style.left=curLeft+'px'}
if(this.options.transitionType==='fade'&&isNewTransition){this.elems.imageCons[curK].style.opacity=0}
if(curTop!==null){this.elems.imageCons[curK].style.top=curTop+'px'}
if(curWidth!==null){this.elems.imageCons[curK].style.width=curWidth+'px'}
if(curHeight!==null){this.elems.imageCons[curK].style.height=curHeight+'px'}
this.elems.imageCons[curK].style.padding=viewer.padding+'px';this.elems.closeCons[curK].style.right=viewer.closeRight+'px';this.elems.closeCons[curK].style.top=viewer.closeTop+'px';this.updateImgClassesAndSrc();if(this.options.transitionType==='size'){this.removePrevViewer()}},updateCaption(){const item=this.getCurGalItem();if(item.isError&&this.options.imageFailedCaptionHtml){this.elems.caption.innerHTML=this.options.imageFailedCaptionHtml;this.elems.captionCon.classList='is-displayed'}else if(item.caption){this.elems.caption.innerHTML=item.caption;this.elems.captionCon.classList='is-displayed'}else{this.elems.caption.innerHTML='';this.elems.captionCon.classList=''}},getElemTagName(elem){if(!elem){return null}
if(!elem.tagName){return null}
return elem.tagName.trim().toLowerCase()},getSubElemAttrVal(elem,attr){if(!elem||!attr){return null}
let val=elem.getAttribute(attr);if(val!==null&&val!==!1){return val}
let subElem=elem.querySelector('['+attr+']');if(!subElem){return null}
val=subElem.getAttribute(attr);return val},getSubElemAttrValBySelector(elem,selector,attr){const subElem=this.getSubElemBySelector(elem,selector);if(!subElem){return null}
let val=subElem.getAttribute(attr);if(val===null){return null}
return val},getSubElemTextBySelector(elem,selector){const subElem=this.getSubElemBySelector(elem,selector);if(!subElem){return null}
const text=subElem.innerHTML;if(text===null){return null}
return text},getSubElemBySelector(elem,selector){if(!elem||!selector){return null}
const subElem=elem.querySelector(selector);if(!subElem){return null}
return subElem},getElemSubByAttr(elem,attr){if(!elem||!attr){return null}
let val=elem.getAttribute(attr);if(val!==null&&val!==!1){return elem}
let item=elem.querySelector('['+attr+']');if(!item){return null}
return item},getViewerCur(){if(this.viewerCurKey===null){return null}
return this.viewers[this.viewerCurKey]},getGalItem(galKey,itemKey){if(!this.isGalItem(galKey,itemKey)){return null}
return this.galleries[galKey].items[itemKey]},isGalItem(galKey,itemKey){if(galKey===null||itemKey===null){return!1}
if(!this.galleries[galKey]){return!1}
if(!this.galleries[galKey].items[itemKey]){return!1}
return!0},getCurGalItem(){const viewer=this.getViewerCur();if(viewer===null){return null}
return this.getGalItem(viewer.galKey,viewer.itemKey)},consoleLog(val1,val2,val3,val4,val5,val6,val7){if(this.options.doConsoleLog){if(typeof val7!=='undefined'){console.log(val1,'|',val2,'|',val3,'|',val4,'|',val5,'|',val6,'|',val7)}else if(typeof val6!=='undefined'){console.log(val1,'|',val2,'|',val3,'|',val4,'|',val5,'|',val6)}else if(typeof val5!=='undefined'){console.log(val1,'|',val2,'|',val3,'|',val4,'|',val5)}else if(typeof val4!=='undefined'){console.log(val1,'|',val2,'|',val3,'|',val4)}else if(typeof val3!=='undefined'){console.log(val1,'|',val2,'|',val3)}else if(typeof val2!=='undefined'){console.log(val1,'|',val2)}else if(typeof val1!=='undefined'){console.log(val1)}}
if(this.options.doConsoleTrace){console.trace()}},consoleError(val1,val2,val3,val4,val5,val6,val7){if(this.options.doConsoleLog){if(typeof val7!=='undefined'){console.error(val1,'|',val2,'|',val3,'|',val4,'|',val5,'|',val6,'|',val7)}else if(typeof val6!=='undefined'){console.error(val1,'|',val2,'|',val3,'|',val4,'|',val5,'|',val6)}else if(typeof val5!=='undefined'){console.error(val1,'|',val2,'|',val3,'|',val4,'|',val5)}else if(typeof val4!=='undefined'){console.error(val1,'|',val2,'|',val3,'|',val4)}else if(typeof val3!=='undefined'){console.error(val1,'|',val2,'|',val3)}else if(typeof val2!=='undefined'){console.error(val1,'|',val2)}else if(typeof val1!=='undefined'){console.error(val1)}}
if(this.options.doConsoleTrace){console.trace()}},createXHR(){if(window.XMLHttpRequest){return new XMLHttpRequest()}
throw new Error("This browser does not support XMLHttpRequest")},strReplaceAll(from,to,str){if(typeof from==='number'){from=from.toString()}
if(typeof to==='number'){to=to.toString()}
if(typeof from==='string'||typeof from==='number'){from=[from]}else{if(Array.isArray(from)){return str}}
from.forEach((curFrom)=>{let prev='';while(prev!==str){prev=str;str=str.replace(curFrom,to,str)}});return str},getByVal(theVar){if(typeof theVar!=='object'){return theVar}
return JSON.parse(JSON.stringify(theVar))},getCurMs(){const d=new Date();return d.getTime()},parseJson(str){let parsed;try{parsed=JSON.parse(str)}catch(e){return!1}
return parsed},};window.onload=function(){RiotGalleryViewer.initialize()}